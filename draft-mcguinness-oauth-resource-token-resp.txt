



Web Authorization Protocol                                 K. McGuinness
Internet-Draft                                               Independent
Intended status: Standards Track                               J. Hanson
Expires: 23 June 2026                                       Keycard Labs
                                                        20 December 2025


         OAuth 2.0 Resource Parameter in Access Token Response
           draft-mcguinness-oauth-resource-token-resp-latest

Abstract

   This specification defines a new parameter resource to be returned in
   OAuth 2.0 access token responses.  It enables clients to confirm that
   the issued token corresponds to the intended resource.  This
   mitigates ambiguity and certain classes of security vulnerabilities
   such as resource mix-up attacks, particularly in systems that use the
   Resource Indicators for OAuth 2.0 specification [RFC8707].

About This Document

   This note is to be removed before publishing as an RFC.

   The latest revision of this draft can be found at
   https://mcguinness.github.io/draft-mcguinness-oauth-resource-token-
   resp/draft-mcguinness-oauth-resource-token-resp.html.  Status
   information for this document may be found at
   https://datatracker.ietf.org/doc/draft-mcguinness-oauth-resource-
   token-resp/.

   Discussion of this document takes place on the Web Authorization
   Protocol Working Group mailing list (mailto:oauth@ietf.org), which is
   archived at https://mailarchive.ietf.org/arch/browse/oauth/.
   Subscribe at https://www.ietf.org/mailman/listinfo/oauth/.

   Source for this draft and an issue tracker can be found at
   https://github.com/mcguinness/draft-mcguinness-resource-token-resp.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 23 June 2026.

Copyright Notice

   Copyright (c) 2025 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Terminology
     2.1.  Terminology
       2.1.1.  Resource vs Audience
   3.  Resource Parameter in Token Response
     3.1.  Authorization Server Processing Rules
       3.1.1.  Overview
     3.2.  Client Processing Rules
       3.2.1.  Overview
       3.2.2.  Summary Table
       3.2.3.  Parsing the resource Parameter
       3.2.4.  Resource Identifier Comparison
       3.2.5.  Client Requested Exactly One Resource
       3.2.6.  Client Requested Multiple Resources
       3.2.7.  Client Did Not Request a Resource
       3.2.8.  Invalid Resource
   4.  Security Considerations
   5.  Privacy Considerations
   6.  IANA Considerations
     6.1.  OAuth Access Token Response Parameters Registry
   7.  Normative References
   Appendix A.  Additional Examples
     A.1.  Requesting a token for a dynamically discovered protected
           resource
   Acknowledgments
   Document History
   Authors' Addresses

1.  Introduction

   OAuth 2.0 defines a framework in which clients request access tokens
   from authorization servers and present them to resource servers.  In
   deployments where multiple protected resources or resource servers
   (APIs) are involved, the Resource Indicators for OAuth 2.0 [RFC8707]
   specification introduced a resource request parameter that allows
   clients to indicate the resource(s) for which the token is intended
   to be used, which an authorization server can use to restrict the
   issued access token's audience.

   However, [RFC8707] does not require the authorization server to
   return any confirmation of the resource(s) to which the access token
   applies (audience).  When an authorization request includes one or
   more resource parameters, the authorization server can exhibit a
   range of behaviors depending on its capabilities and policy
   configuration.

   An authorization server MAY:

   *  Ignore processing the resource parameter and issue an access token
      with no audience restriction, allowing the token to be used for
      any resource.

   *  Ignore processing the resource parameter and issue an access token
      with an audience restricted to a default resource or set of
      resources (for example, when the authorization server does not
      support [RFC8707]).

   *  Accept all requested resource values and issue an access token
      with an audience restricted to the complete set of requested
      resources.

   *  Accept only a subset of requested resource values and issue an
      access token with an audience restricted to that subset,silently
      rejecting the remaining requested resources.

   *  Override the requested resource values and issue an access token
      with an audience restricted to resources determined by the
      authorization server's policy or client registration
      configuration.

   *  Reject the request by returning an error response with the error
      code invalid_target as defined in [RFC8707].

   This leads to ambiguity in the client's interpretation of the access
   token's audience, potentially resulting in *resource mix-up attacks*.
   Consider the following concrete example involving dynamic discovery:

   *Preconditions:*

   *  A client wants to access a protected resource at
      https://api.example.net/data but is not statically configured with
      knowledge of this resource or its authorization server, so it uses
      OAuth 2.0 Protected Resource Metadata [RFC9728] to dynamically
      discover the authorization server.

   *  An attacker controls the protected resource at
      https://api.example.net/data and publishes Protected Resource
      Metadata that claims https://legit-as.example.com (a legitimate,
      trusted authorization server for the resource owner) is the
      authorization server for this resource, listing legitimate-looking
      scopes that are valid for the authorization server (e.g. data:read
      data:write).

   *  The client already has a valid client registration established
      with the legitimate authorization server.

   *  The legitimate authorization server at https://legit-
      as.example.com does not implement support for [RFC8707] and
      ignores the resource parameter in authorization requests and
      instead restricts issued access tokens to an audience based on
      requested scopes.

   *  The user trusts https://legit-as.example.com and would consent to
      legitimate-looking scopes for a legitimite client.

   *Attack Flow:*

   1.  The client fetches Protected Resource Metadata from
       https://api.example.net/data and discovers https://legit-
       as.example.com as the authorization server.

   2.  The client makes an authorization request to https://legit-
       as.example.com including resource=https://api.example.net/data
       along with scopes data:read data:write.

   3.  The authorization server processes the request based on scopes
       (ignoring the resource parameter), and after user consent (which
       may only display scopes without the resource), issues a valid
       access token with an audience for a resource server for the
       application, but without returning any indication of a change in
       audience restriction.

   4.  The client receives the token but cannot verify whether it
       corresponds to https://api.example.net/data (the attacker's
       resource) or some other resource.

   5.  The client uses the issued token to request access to
       https://api.example.net/data (the attacker's resource server).
       The attacker can now replay the access token to obtain access to
       protected resources from the legitimate resource server the user
       delegated to the client with data:read data:write scope.

   The client has no way to validate whether https://legit-
   as.example.com is actually authoritative for https://api.example.net/
   data.  While Protected Resource Metadata can be signed, this would
   require the client to be pre-configured with trust roots for the
   signature key, which defeats the purpose of dynamic discovery of
   protected resources at runtime.  Similarly, while an authorization
   server could publish a list of protected resources that are valid for
   an authorization server it in its metadata [RFC8414], it is not
   feasible in practice to enumerate every protected resource in large
   resource domains with hundreds or more resources.

   Without explicit confirmation of the resource in the token response,
   the client cannot detect when the authorization server has ignored or
   overridden the requested resource indicator, leaving it vulnerable to
   mix-up attacks.  The only protection in this scenario is user
   consent, which may not provide sufficient detail to educate the user
   about the specific resource being authorized, especially when
   authorization servers do not prominently display resource indicators
   in consent screens.

   This document introduces a new parameter resource to be returned in
   the access token response so the client can validate that the issued
   access token corresponds to the intended resource.

2.  Conventions and Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

2.1.  Terminology

   The terms "client", "authorization server", "resource server',
   "access token", "protected resource", "authorization request",
   "access token request", "access token response" are defined by the
   OAuth 2.0 Authorization Framework specification [RFC6749].

   The term "resource" is defined by the Resource Indicators for OAuth
   2.0 specification [RFC8707].

   The term "StringOrURI" is defined by the JWT specification [RFC7519].

2.1.1.  Resource vs Audience

   This specification uses the term resource (as defined in Section 2 of
   [RFC8707] and [RFC9728]) rather than audience (as commonly used in
   access token claims such as the aud claim in JWTs Section 4.1.3 of
   [RFC7519] or in token introspection Section 2.2 of [RFC7662]) because
   a client cannot assume a fixed or discoverable relationship between a
   protected resource URL and an access token’s audience value.

   While a resource and an access token's audience may be the same in
   some deployments, they are not equivalent.  A resource server
   protecting a given resource may accept access tokens with:

   *  A broadly scoped audience restriction such as
      https://api.example.com that specifies an API-wide identifier for
      the resource server(s).

   *  A narrowly scoped audience restriction such as
      https://api.example.com/some/protected/resource that specifies the
      exact URL for a protected resource.

   *  A logical or cross-domain audience restriction such as
      urn:example:api or https://example.net that has no direct
      correspondence to the resource’s URL.

   As a result, a client cannot reliably predict the audience value that
   an authorization server will use to restrict an issued access token's
   audience, nor can it determine which audience values a resource
   server will accept.  This limitation is particularly relevant in
   dynamic environments, such as when using OAuth 2.0 Protected Resource
   Metadata [RFC9728], where the client can discover the protected
   resource URL but not the authorization server's audience assignment
   policy.

   For these reasons, returning an audience value in the token response
   is less useful to the client than returning the resource(s) for which
   the access token was issued.  By returning the resource parameter,
   this specification enables a client to:

   *  Confirm that the access token is valid for the specific resource
      it requested.

   *  Detect resource mix-up conditions in which an authorization server
      issues a token for a different resource than intended.

   This approach is consistent with Resource Indicators [RFC8707] and
   Protected Resource Metadata [RFC9728], which defines the resource
   parameter as the client-facing mechanism for identifying the target
   protected resource, independent of how a resource server enforces
   audience restrictions for access tokens internally.

   Note that a client may use token introspection [RFC7662] if supported
   by an authorization server to determine an issued token's audience if
   needed.

3.  Resource Parameter in Token Response

   Authorization servers that support this specification SHOULD include
   the resource parameter in successful access token responses, as
   defined in Section 5.1 of [RFC6749], to identify a protected resource
   for which the access token is valid.

   The value of the resource parameter MUST be either:

   *  A single case-sensitive string containing an absolute URI value,
      as defined in Section 2 of [RFC8707], when the access token is
      valid for exactly one resource.

   *  An array of case-sensitive strings, each containing an absolute
      URI value, as defined in Section 2 of [RFC8707], when the access
      token is valid for multiple resources.  The array MUST contain at
      least one element, and each element MUST be unique within the
      array.

   The resource parameter uses the same value syntax and requirements as
   the resource request parameter defined in [RFC8707].  In particular,
   each value MUST be an absolute URI, MUST NOT contain a fragment
   component, and SHOULD NOT contain a query component.

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "2YotnFZFEjr1zCsicMWpAA",
     "token_type": "Bearer",
     "expires_in": 3600,
     "resource": "https://api.example.com/"
   }

3.1.  Authorization Server Processing Rules

   An authorization server that supports this specification MUST decide
   whether and how to include the resource parameter in a successful
   access token response (see [RFC6749], Section 5.1) according to the
   rules in this section.

3.1.1.  Overview

   Authorization server processing is driven by the number of resource
   parameters included in the authorization request or token request
   (see [RFC8707]).  The rules below are mutually exclusive and depend
   on whether the client requested zero, exactly one, or more than one
   resource.

   These authorization server processing rules apply equally to access
   tokens issued using the authorization code grant and to access tokens
   issued using a refresh token grant.

   Access tokens issued under these rules are valid for the resource(s)
   identified in the response.

3.1.1.1.  Summary Table

     +==============+===================+============================+
     | Client       | Authorization     | Authorization Server       |
     | Request      | Server Outcome    | Processing Rules           |
     | Shape        |                   |                            |
     +==============+===================+============================+
     | *Exactly one | No acceptable     | MUST return invalid_target |
     | resource     | resource          | and MUST NOT issue an      |
     | requested*   |                   | access token.              |
     +--------------+-------------------+----------------------------+
     |              | One acceptable    | MUST issue an access token |
     |              | resource          | and MUST include resource  |
     |              |                   | as a string containing the |
     |              |                   | accepted resource.         |
     +--------------+-------------------+----------------------------+
     | *Multiple    | No acceptable     | MUST return invalid_target |
     | resource     | resources         | and MUST NOT issue an      |
     | values       |                   | access token.              |
     | requested*   |                   |                            |
     +--------------+-------------------+----------------------------+
     |              | Subset of         | MUST issue an access token |
     |              | requested         | and MUST include resource  |
     |              | resources         | as an array containing     |
     |              | acceptable        | only the accepted subset.  |
     +--------------+-------------------+----------------------------+
     |              | All requested     | MUST issue an access token |
     |              | resources         | and MUST include resource  |
     |              | acceptable        | as an array containing all |
     |              |                   | accepted resources.        |
     +--------------+-------------------+----------------------------+
     | *No resource | Default           | SHOULD issue an access     |
     | requested*   | resource(s)       | token and SHOULD include   |
     |              | assigned          | the assigned resource(s)   |
     |              |                   | in the resource parameter. |
     +--------------+-------------------+----------------------------+
     |              | No resource-      | SHOULD issue an access     |
     |              | specific          | token and SHOULD omit the  |
     |              | restriction       | resource parameter.        |
     +--------------+-------------------+----------------------------+

                                  Table 1

3.1.1.2.  Resource Identifier Comparison

   When comparing resource identifiers (for example, to determine
   uniqueness or to evaluate requested resources against policy), the
   authorization server MUST apply the URI comparison rules defined in
   Section 6.2.1 of [RFC3986], after applying syntax-based normalization
   as defined in Section 6.2.2 of [RFC3986].  Resource identifiers that
   are equivalent under these rules MUST be treated as identical.

3.1.1.3.  Client Requested One or More Resources

   If the client included one or more resource parameters in the
   authorization request or token request:

   *  The authorization server MUST evaluate the requested resource set
      according to local policy and determine the accepted resource set.

   *  If the accepted resource set is empty, the authorization server
      MUST return an invalid_target error response as defined in
      [RFC8707] and MUST NOT issue an access token.

   *  If the accepted resource set is non-empty:

      -  The authorization server MUST include the resource parameter in
         the access token response.

      -  The resource values in the response MUST be limited to the
         accepted resource set and MUST NOT include any resource value
         that was not requested by the client.

      -  The authorization server MUST ensure that the returned resource
         set contains no duplicate resource identifiers (including
         identifiers that differ only by URI normalization).

      -  If the accepted resource set contains exactly one resource, the
         resource parameter value MUST be a string containing that
         single resource identifier.

      -  If the accepted resource set contains more than one resource,
         the resource parameter value MUST be an array of strings
         containing those resource identifiers.

3.1.1.4.  Client Did Not Request a Resource

   If the client did not include any resource parameters in the
   authorization request or token request:

   *  If the authorization server assigns one or more default resources
      based on policy or client configuration, it SHOULD include the
      assigned resource(s) in the resource parameter of the response.

   *  If the access token is not valid for any specific resource (for
      example, when the access token has no resource-specific
      restriction), the resource parameter SHOULD be omitted from the
      response.

3.2.  Client Processing Rules

   A client that supports this extension MUST process the access token
   response according to the rules in this section.

3.2.1.  Overview

   Client processing is driven by the number of resource parameters
   included in the authorization request or token request (see
   [RFC8707]).  The rules below are mutually exclusive and depend on
   whether the client requested zero, exactly one, or more than one
   resource.

   If client validation succeeds, the client MAY use the access token
   and MUST use it only with the resource(s) identified in the response.
   If client validation fails at any point while applying these rules,
   the client MUST NOT use the access token and SHOULD discard it.

   These client processing rules apply equally to access tokens issued
   using the authorization code grant and to access tokens issued using
   a refresh token grant.

3.2.2.  Summary Table

   +=================+======================+==========================+
   | Client          | Token Response       | Client Processing Rules  |
   | Request         |                      |                          |
   | Shape           |                      |                          |
   +=================+======================+==========================+
   | *Exactly one    | resource omitted     | Invalid.  Client MUST    |
   | resource        |                      | NOT use the access token |
   | requested*      |                      | and SHOULD discard it.   |
   +-----------------+----------------------+--------------------------+
   |                 | resource = string    | Valid only if the value  |
   |                 |                      | matches the requested    |
   |                 |                      | resource.                |
   +-----------------+----------------------+--------------------------+
   |                 | resource = array (1  | Valid only if the        |
   |                 | element)             | element matches the      |
   |                 |                      | requested resource.      |
   +-----------------+----------------------+--------------------------+
   |                 | resource = array (>1 | Invalid.  Client MUST    |
   |                 | elements)            | NOT use the access token |
   |                 |                      | and SHOULD discard it.   |
   +-----------------+----------------------+--------------------------+
   | *Multiple       | resource omitted     | Invalid.  Client MUST    |
   | resource        |                      | NOT use the access token |
   | values          |                      | and SHOULD discard it.   |
   | requested*      |                      |                          |
   +-----------------+----------------------+--------------------------+
   |                 | resource = string    | Invalid.  Client MUST    |
   |                 |                      | NOT use the access token |
   |                 |                      | and SHOULD discard it.   |
   +-----------------+----------------------+--------------------------+
   |                 | resource = array     | Valid.  Token is valid   |
   |                 | (subset of           | only for the returned    |
   |                 | requested)           | subset.                  |
   +-----------------+----------------------+--------------------------+
   |                 | resource = array     | Valid.  Token is valid   |
   |                 | (exact match)        | for all returned         |
   |                 |                      | resources.               |
   +-----------------+----------------------+--------------------------+
   |                 | resource = array     | Invalid.  Client MUST    |
   |                 | (includes            | NOT use the access token |
   |                 | unrequested value)   | and SHOULD discard it.   |
   +-----------------+----------------------+--------------------------+
   | *No resource    | resource omitted     | Valid.  Token is not     |
   | requested*      |                      | resource-specific.       |
   +-----------------+----------------------+--------------------------+
   |                 | resource present     | Valid.  Client MAY treat |
   |                 |                      | the returned value as a  |
   |                 |                      | default resource         |
   |                 |                      | assignment.              |
   +-----------------+----------------------+--------------------------+
   | *Any request    | error=invalid_target | Client MUST treat this   |
   | shape*          |                      | as a terminal error and  |
   |                 |                      | MUST NOT use an access   |
   |                 |                      | token.                   |
   +-----------------+----------------------+--------------------------+

                                  Table 2

3.2.3.  Parsing the resource Parameter

   If the access token response includes a resource parameter, the
   client MUST parse it as follows:

   *  A string value represents a single resource identifier.

   *  An array value represents multiple resource identifiers; each
      element MUST be a string.

   *  Any other value is invalid; the client MUST NOT use the access
      token and SHOULD discard it.

3.2.4.  Resource Identifier Comparison

   Resource identifiers MUST be compared using the URI comparison rules
   defined in Section 6.2.1 of [RFC3986], after applying syntax-based
   normalization as defined in Section 6.2.2 of [RFC3986].  Resource
   identifiers that are equivalent under these rules MUST be treated as
   identical.

3.2.5.  Client Requested Exactly One Resource

   If the client included exactly one resource parameter in the token
   request:

   *  The response MUST contain exactly one matching resource
      identifier.

   *  The returned resource identifier MUST match the requested
      resource.

   *  If the response omits the resource parameter or contains zero or
      more than one resource identifier, validation fails.

3.2.5.1.  Authorization Request Example

   Client obtains an access token for the Customers protected resource
   (https://api.example.com/customers) using the authorization code
   grant.

3.2.5.1.1.  Authorization Request

   Client makes an authorization request for the Customers protected
   resource (https://api.example.com/customers).

   GET /authorize?response_type=code
     &client_id=client123
     &redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb
     &scope=customers%3Aread
     &state=abc123
     &resource=https%3A%2F%2Fapi.example.com%2Fcustomers
     &code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
     &code_challenge_method=S256
   HTTP/1.1
   Host: authorization-server.example.com

3.2.5.1.2.  Redirect

   The authorization server redirects the user-agent back to the client
   with an authorization code.

HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA&state=abc123

3.2.5.1.3.  Token Request

   The client exchanges the authorization code for an access token.

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=authorization_code&
   code=SplxlOBeZQQYbYS6WxSbIA&
   redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb&
   client_id=client123&
   code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk

3.2.5.1.4.  Token Response

   The authorization server issues an access token that is valid for the
   Customers protected resource (https://api.example.com/customers).

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "ACCESS_TOKEN",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "customers:read",
     "resource": "https://api.example.com/customers"
   }

3.2.5.2.  Refresh Token Request Example

   Client refreshes an access token for the Customers protected resource
   (https://api.example.com/customers).

3.2.5.2.1.  Refresh Token Request

   The client uses a refresh token to request a new access token that is
   valid for the Customers protected resource (https://api.example.com/
   customers).

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=refresh_token&
   refresh_token=REFRESH_TOKEN&
   client_id=client123&
   scope=customers%3Aread&
   resource=https%3A%2F%2Fapi.example.com%2Fcustomers

3.2.5.2.2.  Token Response

   The authorization server issues a new access token that is valid for
   the Customers protected resource (https://api.example.com/customers).

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "ACCESS_TOKEN",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "customers:read",
     "resource": "https://api.example.com/customers"
   }

3.2.6.  Client Requested Multiple Resources

   If the client included more than one resource parameter in the token
   request:

   *  The response MUST include a resource parameter.

   *  The value MUST be an array.

   *  Each returned resource identifier MUST match one requested
      resource.

   *  The returned set MAY be a strict subset of the requested set.

   *  If any unrequested or duplicate resource identifier is present,
      validation fails.

3.2.6.1.  Authorization Request Example

   Client obtains an access token for the Customers
   (https://api.example.com/customers) and Orders
   (https://api.example.com/orders) protected resources.

3.2.6.1.1.  Authorization Request

   Client makes an authorization request for both protected resources.

   GET /authorize?response_type=code
     &client_id=client123
     &redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb
     &scope=customers%3Aread%20orders%3Aread
     &state=abc123
     &resource=https%3A%2F%2Fapi.example.com%2Fcustomers
     &resource=https%3A%2F%2Fapi.example.com%2Forders
     &code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
     &code_challenge_method=S256
   HTTP/1.1
   Host: authorization-server.example.com

3.2.6.1.2.  Redirect

   The authorization server redirects the user-agent back to the client
   with an authorization code.

HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA&state=abc123

3.2.6.1.3.  Token Request

   The client exchanges the authorization code for an access token.

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=authorization_code&
   code=SplxlOBeZQQYbYS6WxSbIA&
   redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb&
   client_id=client123&
   code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk

3.2.6.1.4.  Token Response

   The authorization server issues an access token that is valid for
   both protected resources.

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "ACCESS_TOKEN",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "customers:read orders:read",
     "resource": [
       "https://api.example.com/customers",
       "https://api.example.com/orders"
     ]
   }

3.2.6.2.  Refresh Token Request Example

   Client refreshes an access token for the Customers and Orders
   protected resources.

3.2.6.2.1.  Refresh Token Request

   The client uses a refresh token to request a new access token that is
   valid for both protected resources.

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=refresh_token&
   refresh_token=REFRESH_TOKEN&
   client_id=client123&
   scope=customers%3Aread%20orders%3Aread&
   resource=https%3A%2F%2Fapi.example.com%2Fcustomers&
   resource=https%3A%2F%2Fapi.example.com%2Forders

3.2.6.2.2.  Token Response

   The authorization server issues a new access token that is valid for
   both protected resources.

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "ACCESS_TOKEN",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "customers:read orders:read",
     "resource": [
       "https://api.example.com/customers",
       "https://api.example.com/orders"
     ]
   }

3.2.7.  Client Did Not Request a Resource

   If the client did not include any resource parameters in the token
   request:

   *  If the response includes a resource parameter, the client MAY
      treat it as a default resource assignment.

   *  If the response omits the resource parameter, the token SHOULD be
      treated as unbounded.

3.2.7.1.  Authorization Request Example

   Client obtains an access token without requesting a specific
   resource.

3.2.7.1.1.  Authorization Request

   Client makes an authorization request without including a resource
   indicator.

   GET /authorize?response_type=code
     &client_id=client123
     &redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb
     &scope=orders%3Aread
     &state=abc123
     &code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
     &code_challenge_method=S256
   HTTP/1.1
   Host: authorization-server.example.com

3.2.7.1.2.  Redirect

   The authorization server redirects the user-agent back to the client
   with an authorization code.

HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA&state=abc123

3.2.7.1.3.  Token Request

   The client exchanges the authorization code for an access token.

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=authorization_code&
   code=SplxlOBeZQQYbYS6WxSbIA&
   redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb&
   client_id=client123&
   code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk

3.2.7.1.4.  Token Response

   The authorization server issues an access token that is valid for the
   default protected resource (https://api.example.com/orders).

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "ACCESS_TOKEN",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "orders:read",
     "resource": "https://api.example.com/orders"
   }

3.2.7.2.  Refresh Token Request Example

   Client refreshes an access token without explicitly requesting a
   resource.

3.2.7.2.1.  Refresh Token Request

   The client uses a refresh token to request a new access token without
   explicitly requesting a resource.

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=refresh_token&
   refresh_token=REFRESH_TOKEN&
   client_id=client123&
   scope=orders%3Aread

3.2.7.2.2.  Token Response

   The authorization server issues a new access token that is valid for
   the default protected resource (https://api.example.com/orders).

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "ACCESS_TOKEN",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "orders:read",
     "resource": "https://api.example.com/orders"
   }

3.2.8.  Invalid Resource

   An invalid_target error indicates that none of the requested resource
   values were acceptable to the authorization server.  This outcome may
   result from authorization server policy or client configuration.

   Upon receiving an invalid_target error, the client MAY retry the
   authorization request with a different resource value.

3.2.8.1.  Authorization Request Example

   Client attempts to obtain an access token for a protected resource
   (https://unknown.example.com) that is not permitted.

3.2.8.1.1.  Authorization Request

   Client makes an authorization request for a protected resource that
   is not permitted.

   GET /authorize?response_type=code
     &client_id=client123
     &redirect_uri=https%3A%2F%2Fclient.example.com%2Fcb
     &scope=customers%3Aread
     &state=invalid123
     &resource=https%3A%2F%2Fevil.example.net%2F
     &code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
     &code_challenge_method=S256
   HTTP/1.1
   Host: authorization-server.example.com

3.2.8.1.2.  Error Redirect

   The authorization server rejects the requested resource and does not
   issue an authorization code.

HTTP/1.1 302 Found
Location: https://client.example.com/cb?error=invalid_target&error_description=Resource%20not%20allowed&state=invalid123

3.2.8.2.  Refresh Token Request Example

   Client attempts to refresh an access token for a protected resource
   (https://unknown.example.com) that is not permitted.

3.2.8.2.1.  Refresh Token Request

   The client uses a refresh token to request a new access token for a
   protected resource that is not permitted.

   POST /token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=refresh_token&
   refresh_token=REFRESH_TOKEN&
   client_id=client123&
   scope=customers%3Aread&
   resource=https%3A%2F%2Fevil.example.net%2F

3.2.8.2.2.  Error Response

   The authorization server rejects the requested resource.

   HTTP/1.1 400 Bad Request
   Content-Type: application/json
   Cache-Control: no-store

   {
     "error": "invalid_target",
     "error_description": "Resource not allowed"
   }

4.  Security Considerations

   The lack of confirmation about which resource(s) an authorization
   server has selected for an access token introduces a security risk in
   OAuth deployments, particularly when:

   *  A client uses multiple authorization servers and resource servers.

   *  A client dynamically discovers an authorization server and
      attempts to obtain an access token at runtime via an HTTP
      authorization challenge with OAuth 2.0 Protected Resource Metadata
      [RFC9728].

   *  An attacker attempts a *mix-up attack* where a token intended for
      one resource is used at another.

   *  The authorization server ignores or overrides the requested
      resource without informing the client.

   This specification addresses such issues by explicitly returning the
   resource(s) for which the access token is intended in the token
   response.

   A malicious protected resource may intercept an access token during a
   client's legitimate request and subsequently reuse that token to
   access other resources that trust the same authorization server and
   accept tokens with the same audience and scopes.  This attack is
   particularly relevant when the client cannot fully validate the trust
   relationship between the protected resource and the authorization
   server, such as in dynamic discovery scenarios using [RFC9728].

   To prevent token reuse attacks by malicious protected resources,
   access tokens SHOULD require proof-of-possession, such as DPoP
   (Demonstrating Proof-of-Possession) as defined in [RFC9449].  By
   binding the access token to a cryptographic key held by the client
   and requiring demonstration of key possession when using the token,
   proof-of-possession mechanisms prevent a malicious protected resource
   that intercepts the access token from reusing it at other resources,
   since it does not possess the client's private key.  Both the client
   and authorization server must support proof-of-possession mechanisms
   for this protection to be effective.  See Section 9 of [RFC9449] for
   details on how DPoP provides proof-of-possession.

   Validating the resource parameter in the token response provides
   defense-in-depth for the client.  While it helps the client detect
   when an authorization server has issued a token for a different
   resource than requested, it does not prevent a malicious protected
   resource from reusing an intercepted token at other resources.
   Clients are advised to validate the resource parameter as specified
   in Client Processing Rules (Section 3.2) and treat mismatches as
   errors unless explicitly designed to handle token audience
   negotiation.  Clients that require strict resource binding SHOULD
   treat the absence of the resource parameter as a potential ambiguity.

5.  Privacy Considerations

   Returning the resource value may reveal some information about the
   protected resource.  If the value is sensitive, the authorization
   server SHOULD assess whether the resource name can be safely
   disclosed to the client.

6.  IANA Considerations

   This document registers the following value in the OAuth Parameters
   registry established by [RFC6749].

6.1.  OAuth Access Token Response Parameters Registry

           +==========+=======================+===============+
           | Name     | Description           | Specification |
           +==========+=======================+===============+
           | resource | Resource to which the | This document |
           |          | access token applies  |               |
           +----------+-----------------------+---------------+

                                 Table 3

7.  Normative References

   [RFC6749]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              RFC 6749, DOI 10.17487/RFC6749, October 2012,
              <https://www.rfc-editor.org/info/rfc6749>.

   [RFC8707]  Campbell, B., Bradley, J., and H. Tschofenig, "Resource
              Indicators for OAuth 2.0", RFC 8707, DOI 10.17487/RFC8707,
              February 2020, <https://www.rfc-editor.org/info/rfc8707>.

   [RFC9728]  Jones, M.B., Hunt, P., and A. Parecki, "OAuth 2.0
              Protected Resource Metadata", RFC 9728,
              DOI 10.17487/RFC9728, April 2025,
              <https://www.rfc-editor.org/info/rfc9728>.

   [RFC8414]  Jones, M., Sakimura, N., and J. Bradley, "OAuth 2.0
              Authorization Server Metadata", RFC 8414,
              DOI 10.17487/RFC8414, June 2018,
              <https://www.rfc-editor.org/info/rfc8414>.

   [RFC9207]  Meyer zu Selhausen, K. and D. Fett, "OAuth 2.0
              Authorization Server Issuer Identification", RFC 9207,
              DOI 10.17487/RFC9207, March 2022,
              <https://www.rfc-editor.org/info/rfc9207>.

   [RFC3986]  Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform
              Resource Identifier (URI): Generic Syntax", STD 66,
              RFC 3986, DOI 10.17487/RFC3986, January 2005,
              <https://www.rfc-editor.org/info/rfc3986>.

   [RFC7519]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", RFC 7519, DOI 10.17487/RFC7519, May 2015,
              <https://www.rfc-editor.org/info/rfc7519>.

   [RFC7662]  Richer, J., Ed., "OAuth 2.0 Token Introspection",
              RFC 7662, DOI 10.17487/RFC7662, October 2015,
              <https://www.rfc-editor.org/info/rfc7662>.

   [RFC9700]  Lodderstedt, T., Bradley, J., Labunets, A., and D. Fett,
              "Best Current Practice for OAuth 2.0 Security", BCP 240,
              RFC 9700, DOI 10.17487/RFC9700, January 2025,
              <https://www.rfc-editor.org/info/rfc9700>.

   [RFC9449]  Fett, D., Campbell, B., Bradley, J., Lodderstedt, T.,
              Jones, M., and D. Waite, "OAuth 2.0 Demonstrating Proof of
              Possession (DPoP)", RFC 9449, DOI 10.17487/RFC9449,
              September 2023, <https://www.rfc-editor.org/info/rfc9449>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

Appendix A.  Additional Examples

A.1.  Requesting a token for a dynamically discovered protected resource

   The following example details the need for the resource parameter
   when a client dynamically discovers an authorization server and
   obtains an access token using [RFC9728] and [RFC8414]

   Client attempts to access a protected a resource without a valid
   access token

   GET /resource
   Host: api.example.com
   Accept: application/json

   Client is challenged for authentication

   HTTP/1.1 401 Unauthorized
   WWW-Authenticate: Bearer resource_metadata=
     "https://api.example.com/.well-known/oauth-protected-resource"

   Client fetches the resource's OAuth 2.0 Protected Resource Metadata
   per [RFC9728] to dynamically discover an authorization server that
   can issue an access token for the resource.

   GET /.well-known/oauth-protected-resource
   Host: api.example.com
   Accept: application/json

   HTTP/1.1 200 Ok
   Content-Type: application/json

   {
      "resource":
        "https://api.example.com/resource",
      "authorization_servers":
        [ "https://authorization-server.example.com/" ],
      "bearer_methods_supported":
        ["header", "body"],
      "scopes_supported":
        ["resource.read", "resource.write"],
      "resource_documentation":
        "https://api.example.com/resource_documentation.html"
    }

   Client discovers the Authorization Server configuration per [RFC8414]

GET /.well-known/oauth-authorization-server
Host: authorization-server.example.com
Accept: application/json

HTTP/1.1 200 Ok
Content-Type: application/json

{
  "issuer": "https://authorization-server.example.com/",
  "authorization_endpoint": "https://authorization-server.example.com/oauth2/authorize",
  "token_endpoint": "https://authorization-server.example.com/oauth2/token",
  "jwks_uri": "https://authorization-server.example.com/oauth2/keys",
  "scopes_supported": [
    "resource.read", "resource.write"
  ],
  "response_types_supported": [
    "code"
  ],
  "grant_types_supported": [
    "authorization_code", "refresh_token"
  ],
  ...
}

   Client makes an authorization request for the resource

   GET /oauth2/authorize?response_type=code
     &client_id=client123
     &redirect_uri=https%3A%2F%2Fclient.example%2Fcallback
     &scope=resource%3Aread
     &state=abc123
     &resource=https%3A%2F%2Fapi.example.com%2Fresource
     &code_challenge=E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM
     &code_challenge_method=S256
   HTTP/1.1
   Host: authorization-server.example.com

   User successfully authenticates and delegates access to the client
   for the requested resource and scopes

HTTP/1.1 302 Found
Location: https://client.example/callback?code=SplxlOBeZQQYbYS6WxSbIA&state=abc123

   Client exchanges the authorization code for an access token

   POST /oauth2/token HTTP/1.1
   Host: authorization-server.example.com
   Content-Type: application/x-www-form-urlencoded

   grant_type=authorization_code&
   code=SplxlOBeZQQYbYS6WxSbIA&
   redirect_uri=https%3A%2F%2Fclient.example%2Fcallback&
   client_id=client123&
   code_verifier=dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk

   Client obtains an access token for the resource.

   HTTP/1.1 200 OK
   Content-Type: application/json
   Cache-Control: no-store

   {
     "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
     "token_type": "Bearer",
     "expires_in": 3600,
     "scope": "resource:read",
     "resource": "https://api.example.com/resource"
   }

   Client verifies that it obtained an access token explicitly bound to
   the discovered resource.

Acknowledgments

   This proposal builds on prior work in OAuth 2.0 extensibility and
   security analysis, particularly [RFC8707], [RFC9700], and [RFC9207].

Document History

   -01

   *  Revised Introduction and included attack example

   *  Provided context for use of Resource vs Audience

   *  Revised Response to clarify Authorization Server and Client
      Processing Rules

   *  Updated Security Considerations

   *  Document cleanup and consistency

   -00

   *  Initial revision

Authors' Addresses

   Karl McGuinness
   Independent
   Email: public@karlmcguinness.com


   Jared Hanson
   Keycard Labs
   Email: jared@keycard.ai
   URI:   https://keycard.ai
